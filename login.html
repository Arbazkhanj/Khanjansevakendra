<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Login - Khan Jan Seva Kendra</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{margin:0;font-family:'Segoe UI',Arial,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:#123;}
    
    /* Loading Overlay */
    .loading-overlay{
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(255,255,255,0.95);z-index:9999;
      display:none;flex-direction:column;justify-content:center;align-items:center;
    }
    .spinner{
      width:50px;height:50px;border:5px solid #f3f3f3;
      border-top:5px solid #667eea;border-radius:50%;
      animation:spin 1s linear infinite;
    }
    @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
    
    /* Toast Notifications */
    .toast{
      position:fixed;top:20px;right:20px;padding:15px 25px;
      border-radius:8px;color:white;font-weight:600;z-index:10000;
      transform:translateX(400px);transition:transform 0.3s;max-width:350px;
    }
    .toast.show{transform:translateX(0);}
    .toast.success{background:#4caf50;}
    .toast.error{background:#f44336;}
    .toast.info{background:#2196f3;}
    
    /* Header */
    header{
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 28px;
      background:linear-gradient(90deg,#2196f3,#ff5722);
      color:white;position:sticky;top:0;z-index:1000;
      font-weight:700;box-shadow:0 2px 10px rgba(0,0,0,0.1);
    }
    .header-left{display:flex;align-items:center;gap:12px;}
    .header-left img{width:44px;height:44px;border-radius:50%;object-fit:cover;border:2px solid white;}
    .site-title{font-size:20px;font-weight:700;}
    nav{display:flex;align-items:center;gap:16px;}
    nav a{color:white;text-decoration:none;font-weight:600;transition:.3s;padding:6px 12px;border-radius:4px;}
    nav a:hover{background:rgba(255,255,255,0.2);transform:translateY(-2px);}
    .login-btn{background:white;color:#2196f3;padding:6px 14px;border-radius:6px;text-decoration:none;font-weight:700;}
    
    /* Main Container */
    .container{max-width:450px;margin:40px auto;padding:20px;}
    
    /* Login Box */
    .login-box{
      background:white;padding:40px;border-radius:16px;
      box-shadow:0 20px 60px rgba(0,0,0,0.3);
      animation:slideUp 0.5s ease;
    }
    @keyframes slideUp{
      from{opacity:0;transform:translateY(30px);}
      to{opacity:1;transform:translateY(0);}
    }
    
    h1{text-align:center;color:#333;margin-bottom:10px;font-size:28px;}
    .subtitle{text-align:center;color:#666;margin-bottom:30px;font-size:14px;}
    
    /* Toggle Buttons */
    .login-toggle{
      display:flex;background:#f0f0f0;border-radius:8px;padding:4px;margin-bottom:30px;
    }
    .toggle-btn{
      flex:1;padding:12px;border:none;background:transparent;cursor:pointer;
      border-radius:6px;font-weight:600;transition:0.3s;color:#666;
    }
    .toggle-btn.active{background:white;color:#2196f3;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
    
    /* Forms */
    .form-section{display:none;}
    .form-section.active{display:block;animation:fadeIn 0.3s;}
    @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
    
    .input-group{
      position:relative;margin-bottom:20px;
    }
    .input-group i{
      position:absolute;left:12px;top:50%;transform:translateY(-50%);
      color:#999;font-size:16px;
    }
    .input-group input{
      width:100%;padding:12px 12px 12px 40px;
      border:2px solid #e0e0e0;border-radius:8px;font-size:14px;
      transition:0.3s;
    }
    .input-group input:focus{
      outline:none;border-color:#2196f3;
    }
    .input-group .toggle-password{
      position:absolute;right:12px;top:50%;transform:translateY(-50%);
      cursor:pointer;color:#999;
    }
    
    /* Admin Badge */
    .admin-badge{
      background:linear-gradient(90deg,#ff5722,#ff8a65);
      color:white;padding:8px 16px;border-radius:20px;
      font-size:12px;font-weight:700;text-align:center;margin-bottom:20px;
      display:inline-block;width:100%;
    }
    
    /* Buttons */
    .btn{
      width:100%;padding:14px;background:linear-gradient(90deg,#2196f3,#21cbf3);
      color:white;border:none;border-radius:8px;font-size:16px;font-weight:700;
      cursor:pointer;transition:0.3s;text-transform:uppercase;letter-spacing:1px;
      display:flex;align-items:center;justify-content:center;gap:10px;
    }
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(33,150,243,0.3);}
    .btn:disabled{background:#ccc;cursor:not-allowed;transform:none;}
    
    /* Links */
    .links{
      display:flex;justify-content:space-between;margin-top:20px;
      font-size:14px;
    }
    .links a{color:#2196f3;text-decoration:none;font-weight:600;}
    .links a:hover{text-decoration:underline;}
    
    /* Signup Link */
    .signup-link{
      text-align:center;margin-top:25px;padding-top:20px;
      border-top:1px solid #eee;
    }
    .signup-link p{color:#666;margin-bottom:10px;}
    .signup-link a{
      color:#ff5722;font-weight:700;text-decoration:none;font-size:16px;
    }
    
    /* Error/Success Messages */
    .message{
      padding:12px;border-radius:6px;margin-bottom:20px;
      font-size:14px;display:none;
    }
    .error{background:#ffebee;color:#c62828;border:1px solid #ef9a9a;}
    .success{background:#e8f5e9;color:#2e7d32;border:1px solid #a5d6a7;}
    
    /* Footer */
    .footer{
      background:rgba(0,0,0,0.3);color:white;text-align:center;
      padding:20px;margin-top:60px;font-size:14px;
    }
    
    /* Responsive */
    @media(max-width:480px){
      .container{margin:20px;padding:10px;}
      .login-box{padding:25px;}
      nav{display:none;}
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <p style="margin-top:20px;color:#667eea;font-weight:600;">Please wait...</p>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer"></div>

  <!-- Header -->
  <header>
    <div class="header-left">
      <img src="shop.jpg" alt="Shop Logo" onerror="this.src='https://via.placeholder.com/44'">
      <span class="site-title">Khan Jan Seva Kendra</span>
    </div>
    <nav>
      <a href="index.html"><i class="fas fa-home"></i> Home</a>
      <a href="services.html"><i class="fas fa-cogs"></i> Services</a>
      <a href="about.html"><i class="fas fa-info-circle"></i> About</a>
      <a href="contact.html"><i class="fas fa-phone"></i> Contact</a>
      <a href="Latest job.html"><i class="fas fa-briefcase"></i> Jobs</a>
      <a href="login.html" class="login-btn"><i class="fas fa-user"></i> Login</a>
    </nav>
  </header>

  <!-- Main Content -->
  <div class="container">
    <div class="login-box">
      <h1><i class="fas fa-lock"></i> Secure Login</h1>
      <p class="subtitle">Khan Jan Seva Kendra - Admin & Customer Portal</p>
      
      <!-- Toggle Buttons -->
      <div class="login-toggle">
        <button class="toggle-btn active" onclick="switchLogin('customer')">
          <i class="fas fa-user"></i> Customer
        </button>
        <button class="toggle-btn" onclick="switchLogin('admin')">
          <i class="fas fa-shield-alt"></i> Admin
        </button>
      </div>
      
      <!-- Messages -->
      <div id="messageBox" class="message"></div>
      
      <!-- Customer Login Form -->
      <div id="customerLogin" class="form-section active">
        <form onsubmit="return loginCustomer(event)">
          <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input type="email" id="custEmail" placeholder="Email Address" required>
          </div>
          <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="custPassword" placeholder="Password" required>
            <i class="fas fa-eye toggle-password" onclick="togglePassword('custPassword')"></i>
          </div>
          <div class="links">
            <label style="display:flex;align-items:center;gap:5px;cursor:pointer;">
              <input type="checkbox" id="rememberMe" style="width:auto;"> Remember me
            </label>
            <a href="#" onclick="showForgotPassword()">Forgot Password?</a>
          </div>
          <button type="submit" class="btn" id="custLoginBtn">
            <i class="fas fa-sign-in-alt"></i> Login
          </button>
        </form>
        
        <div class="signup-link">
          <p>New Customer?</p>
          <a href="#" onclick="showSignup()"><i class="fas fa-user-plus"></i> Create Account</a>
        </div>
      </div>
      
      <!-- Admin Login Form -->
      <div id="adminLogin" class="form-section">
        <div class="admin-badge">
          <i class="fas fa-crown"></i> ADMIN ACCESS ONLY
        </div>
        <form onsubmit="return loginAdmin(event)">
          <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input type="email" id="adminEmail" placeholder="Admin Email" required>
          </div>
          <div class="input-group">
            <i class="fas fa-key"></i>
            <input type="password" id="adminPassword" placeholder="Password" required>
            <i class="fas fa-eye toggle-password" onclick="togglePassword('adminPassword')"></i>
          </div>
          <button type="submit" class="btn" id="adminLoginBtn" style="background:linear-gradient(90deg,#ff5722,#ff8a65);">
            <i class="fas fa-shield-alt"></i> Admin Login
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Signup Modal -->
  <div id="signupModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:2000;overflow-y:auto;">
    <div style="max-width:500px;margin:50px auto;background:white;padding:40px;border-radius:16px;position:relative;">
      <button onclick="closeSignup()" style="position:absolute;top:15px;right:15px;background:none;border:none;font-size:24px;cursor:pointer;color:#666;">
        <i class="fas fa-times"></i>
      </button>
      <h2 style="text-align:center;color:#333;margin-bottom:10px;"><i class="fas fa-user-plus"></i> Customer Registration</h2>
      <p style="text-align:center;color:#666;margin-bottom:30px;">Join Khan Jan Seva Kendra</p>
      
      <form onsubmit="return registerCustomer(event)">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
          <div class="input-group">
            <i class="fas fa-user"></i>
            <input type="text" id="regName" placeholder="Full Name" required>
          </div>
          <div class="input-group">
            <i class="fas fa-phone"></i>
            <input type="tel" id="regMobile" placeholder="Mobile Number" pattern="[0-9]{10}" required>
          </div>
        </div>
        <div class="input-group">
          <i class="fas fa-envelope"></i>
          <input type="email" id="regEmail" placeholder="Email Address" required>
        </div>
        <div class="input-group">
          <i class="fas fa-lock"></i>
          <input type="password" id="regPassword" placeholder="Create Password" minlength="6" required>
        </div>
        <div class="input-group">
          <i class="fas fa-check-circle"></i>
          <input type="password" id="regConfirmPass" placeholder="Confirm Password" required>
        </div>
        <button type="submit" class="btn" id="regBtn">
          <i class="fas fa-user-check"></i> Register Now
        </button>
      </form>
      <p style="text-align:center;margin-top:20px;color:#666;font-size:14px;">
        Already have an account? <a href="#" onclick="closeSignup()" style="color:#2196f3;font-weight:600;">Login here</a>
      </p>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>Â© 2025 Khan Jan Seva Kendra | All Rights Reserved</p>
    <p style="margin-top:5px;font-size:12px;opacity:0.8;">Secure Login System | Admin & Customer Portal</p>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Firebase Configuration
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { 
      getAuth, 
      signInWithEmailAndPassword, 
      createUserWithEmailAndPassword,
      signOut,
      onAuthStateChanged,
      updateProfile,
      sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { 
      getDatabase, 
      ref, 
      set, 
      get, 
      child,
      update 
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyACbkpT74plbA6REQnbF1775ZbwbnhJemk",
      authDomain: "khan-jan-seva-kendra-ac2f2.firebaseapp.com",
      databaseURL: "https://khan-jan-seva-kendra-ac2f2-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "khan-jan-seva-kendra-ac2f2",
      storageBucket: "khan-jan-seva-kendra-ac2f2.firebasestorage.app",
      messagingSenderId: "894379656916",
      appId: "1:894379656916:web:a45feb916031b5a3afdd41",
      measurementId: "G-6EKFZXQFCS"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);

    // Global Variables
    let currentMode = 'customer';

    // Toast Notification
    window.showToast = function(message, type = 'info') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i> ${message}`;
      container.appendChild(toast);
      setTimeout(() => toast.classList.add('show'), 10);
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 5000);
    };

    // Show/Hide Loading
    window.showLoading = function(show) {
      document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
    };

    // Show Message
    window.showMessage = function(text, type) {
      const box = document.getElementById('messageBox');
      box.textContent = text;
      box.className = 'message ' + type;
      box.style.display = 'block';
      setTimeout(() => box.style.display = 'none', 5000);
    };

    // Switch Login Type
    window.switchLogin = function(type) {
      currentMode = type;
      document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.form-section').forEach(form => form.classList.remove('active'));
      
      if(type === 'admin') {
        document.querySelectorAll('.toggle-btn')[1].classList.add('active');
        document.getElementById('adminLogin').classList.add('active');
      } else {
        document.querySelectorAll('.toggle-btn')[0].classList.add('active');
        document.getElementById('customerLogin').classList.add('active');
      }
    };

    // Toggle Password
    window.togglePassword = function(fieldId) {
      const field = document.getElementById(fieldId);
      field.type = field.type === 'password' ? 'text' : 'password';
    };

    // Customer Login
    window.loginCustomer = async function(e) {
      e.preventDefault();
      const email = document.getElementById('custEmail').value;
      const password = document.getElementById('custPassword').value;
      const btn = document.getElementById('custLoginBtn');
      
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
      showLoading(true);
      
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        // Get user data from database
        const userRef = ref(database, `users/${user.uid}`);
        const snapshot = await get(userRef);
        
        if(snapshot.exists()) {
          const userData = snapshot.val();
          
          // Check if customer
          if(userData.role !== 'customer') {
            showToast('This account is not registered as customer!', 'error');
            await signOut(auth);
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
            showLoading(false);
            return false;
          }
          
          showToast(`Welcome back, ${userData.name}!`, 'success');
          
          // Redirect to customer dashboard
          setTimeout(() => {
            window.location.href = 'customer/dashboard.html';
          }, 1500);
        } else {
          showToast('User data not found!', 'error');
        }
      } catch (error) {
        console.error('Login error:', error);
        let errorMsg = 'Login failed!';
        if(error.code === 'auth/user-not-found') errorMsg = 'Email not registered!';
        else if(error.code === 'auth/wrong-password') errorMsg = 'Wrong password!';
        else if(error.code === 'auth/invalid-email') errorMsg = 'Invalid email!';
        else errorMsg = error.message;
        
        showToast(errorMsg, 'error');
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
      }
      
      showLoading(false);
      return false;
    };

    // Admin Login
    window.loginAdmin = async function(e) {
      e.preventDefault();
      const email = document.getElementById('adminEmail').value;
      const password = document.getElementById('adminPassword').value;
      const btn = document.getElementById('adminLoginBtn');
      
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
      showLoading(true);
      
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        // Get user data from database
        const userRef = ref(database, `users/${user.uid}`);
        const snapshot = await get(userRef);
        
        if(snapshot.exists()) {
          const userData = snapshot.val();
          
          // Check if admin
          if(userData.role !== 'admin') {
            showToast('Access denied! Not an admin account.', 'error');
            await signOut(auth);
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-shield-alt"></i> Admin Login';
            showLoading(false);
            return false;
          }
          
          showToast('Admin login successful!', 'success');
          
          // Redirect to admin dashboard
          setTimeout(() => {
            window.location.href = 'admin/dashboard.html';
          }, 1500);
        } else {
          showToast('Admin data not found!', 'error');
        }
      } catch (error) {
        console.error('Admin login error:', error);
        let errorMsg = 'Login failed!';
        if(error.code === 'auth/user-not-found') errorMsg = 'Admin email not found!';
        else if(error.code === 'auth/wrong-password') errorMsg = 'Wrong password!';
        else errorMsg = error.message;
        
        showToast(errorMsg, 'error');
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-shield-alt"></i> Admin Login';
      }
      
      showLoading(false);
      return false;
    };

    // Show Signup Modal
    window.showSignup = function() {
      document.getElementById('signupModal').style.display = 'block';
      document.body.style.overflow = 'hidden';
    };

    window.closeSignup = function() {
      document.getElementById('signupModal').style.display = 'none';
      document.body.style.overflow = 'auto';
    };

    // Register Customer
    window.registerCustomer = async function(e) {
      e.preventDefault();
      
      const name = document.getElementById('regName').value;
      const mobile = document.getElementById('regMobile').value;
      const email = document.getElementById('regEmail').value;
      const password = document.getElementById('regPassword').value;
      const confirmPass = document.getElementById('regConfirmPass').value;
      const btn = document.getElementById('regBtn');
      
      // Validation
      if(password !== confirmPass) {
        showToast('Passwords do not match!', 'error');
        return false;
      }
      
      if(password.length < 6) {
        showToast('Password must be at least 6 characters!', 'error');
        return false;
      }
      
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';
      showLoading(true);
      
      try {
        // Create user in Firebase Auth
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        // Update profile
        await updateProfile(user, { displayName: name });
        
        // Save user data in Realtime Database
        await set(ref(database, `users/${user.uid}`), {
          name: name,
          email: email,
          mobile: mobile,
          role: 'customer',
          createdAt: Date.now(),
          updatedAt: Date.now()
        });
        
        showToast('Registration successful! Please login.', 'success');
        closeSignup();
        
        // Auto-fill login
        document.getElementById('custEmail').value = email;
        document.getElementById('custPassword').value = '';
        
        // Switch to customer login
        switchLogin('customer');
        
      } catch (error) {
        console.error('Registration error:', error);
        let errorMsg = 'Registration failed!';
        if(error.code === 'auth/email-already-in-use') errorMsg = 'Email already registered!';
        else if(error.code === 'auth/invalid-email') errorMsg = 'Invalid email!';
        else if(error.code === 'auth/weak-password') errorMsg = 'Password too weak!';
        else errorMsg = error.message;
        
        showToast(errorMsg, 'error');
      }
      
      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-user-check"></i> Register Now';
      showLoading(false);
      return false;
    };

    // Forgot Password
    window.showForgotPassword = async function() {
      const email = prompt('Enter your registered email address:');
      if(email) {
        try {
          await sendPasswordResetEmail(auth, email);
          showToast('Password reset email sent! Check your inbox.', 'success');
        } catch (error) {
          showToast('Failed to send reset email: ' + error.message, 'error');
        }
      }
    };

    // Check if already logged in
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        // Get user role
        const userRef = ref(database, `users/${user.uid}`);
        const snapshot = await get(userRef);
        
        if(snapshot.exists()) {
          const userData = snapshot.val();
          
          // Auto redirect based on role
          if(userData.role === 'admin') {
            window.location.href = 'admin/dashboard.html';
          } else {
            window.location.href = 'customer/dashboard.html';
          }
        }
      }
    });

    // Close modal on outside click
    window.onclick = function(event) {
      const modal = document.getElementById('signupModal');
      if(event.target === modal) {
        closeSignup();
      }
    };
  </script>
</body>
</html>
